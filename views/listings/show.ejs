<%- layout("/layouts/boilerplate") %>
  <script>
    const mapToken = "<%= process.env.MAP_TOKEN %>"
    const cordinates = <%- JSON.stringify(listDetail.geometry.coordinates) %>
  </script>


  <body class="bg-light">

    <div class="container mt-5">
      <div class="row justify-content-center">
        <div class="col-md-9 col-lg-7">

          <div class="card shadow-sm listing-card">
            <img class="" height="300px" src="<%= listDetail.image.url %>"  alt="Listing image" />

            <div class="card-body">

              <h4 class="card-title mb-2">
                <%= listDetail.title %>
              </h4>

              <h6><i> Hosted By : 
                <%= listDetail.owner.username %>
              </i></h6>

              <p class="card-text text-muted">
                <%= listDetail.description %>
              </p>

              <h5 class="price mb-3">
                ‚Çπ <%= listDetail.price.toLocaleString("en-IN") %>
              </h5>

              <p class="card-text text-muted">
                category : 
                <%= listDetail.category %>
              </p>

              <p class="location mb-1">
                üìç <%= listDetail.location %>, <%= listDetail.country %>
              </p>

              <% if (currUser && currUser._id.equals(listDetail.owner._id)) { %>
                <div class="d-flex gap-2 mt-4">
                  <a href="/listings/<%= listDetail._id %>/edit" class="btn btn-outline-dark w-50">
                    Edit
                  </a>

                  <form method="POST" action="/listings/<%= listDetail._id %>?_method=DELETE" class="w-50">
                    <button class="btn btn-danger w-100">
                      Delete
                    </button>
                  </form>
                </div>
                <hr>
                <% } %>
                  
                  <% if (currUser) { %>

                    <div class="review mt-4">
                      <div class="card shadow-sm">
                        <div class="card-body">

                          <h5 class="card-title mb-3">Leave a Review</h5>

                          <form action="/listings/<%= listDetail._id %>/reviews" method="POST" novalidate
                            class="needs-validation">

                            <!-- Rating -->
                            <div class="mb-3">
                              <label class="form-label fw-semibold">
                                Rating (1‚Äì5)
                              </label>

                              <input type="range" class="form-range" name="review[rating]" min="1" max="5" step="1" />

                              <div class="d-flex justify-content-between small text-muted">
                                <span>1</span>
                                <span>2</span>
                                <span>3</span>
                                <span>4</span>
                                <span>5</span>
                              </div>
                            </div>

                            <!-- Comment -->
                            <div class="mb-3">
                              <label class="form-label fw-semibold">
                                Comment
                              </label>
                              <textarea name="review[comment]" class="form-control" rows="3"
                                placeholder="Share your experience..." required></textarea>
                              <div class="invalid-feedback">please add some comments</div>
                            </div>
                            <!-- Submit -->
                            <button type="submit" class="btn btn-dark">
                              Submit Review
                            </button>
                          </form>
                        </div>
                      </div>
                    </div>
                    <% } %>
                      <hr>
                      <div class="allreviews mt-4">
                        <h4 class="mb-3">All Reviews</h4>
                        <div class="row">
                          <% for (let review of listDetail.reviews) { %>
                            <div class="col-md-6 mb-3">
                              <div class="card shadow-sm review-card">
                                <div class="card-body">
                                  <h5>@<%= review.author.username %>
                                  </h5>
                                  <p class="card-text mb-2">
                                    <%= review.comment %>
                                  </p>

                                  <span class="badge bg-success">
                                    ‚≠ê <%= review.rating %> / 5
                                  </span>
                                </div>
                                <!-- Delete Button -->
                                <form action="/listings/<%= listDetail._id %>/reviews/<%= review._id %>?_method=DELETE"
                                  method="POST">
                                  <button class="btn btn-sm btn-danger m-2 mt-0">
                                    üóë Delete
                                  </button>
                                </form>
                              </div>
                            </div>
                            <% } %>
                        </div>
                        
                        <div>
                          <h3> Where you'll be</h3>
                          <div id="map"></div>
                        </div>
                      </div>
                      

            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="/js/map.js"></script>
  </body>